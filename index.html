<script>
        document.addEventListener("DOMContentLoaded", () => {
            
            // --- 1. INITIALIZE THE QR CODE OBJECT ---
            // This is the core 'engine' from the new library
            
            // THE FIX IS HERE: It is 'QRCodeStyling', not 'QRCodeStylING'
            const qrCode = new QRCodeStyling({
                width: 300,
                height: 300,
                type: "svg", // Use SVG for crisp, clean rendering
                data: "https://www.google.com", // Default data
                image: "", // Placeholder for logo
                dotsOptions: {
                    color: "#000000",
                    type: "rounded"
                },
                backgroundOptions: {
                    color: "#ffffff",
                },
                imageOptions: {
                    crossOrigin: "anonymous",
                    margin: 10
                },
                qrOptions: {
                    errorCorrectionLevel: "H" // 'H' (High) is essential for logo embedding
                }
            });

            // Append the QR code to our preview div
            qrCode.append(document.getElementById("qrcode-canvas"));
            
            // --- 2. TAB SWITCHING LOGIC ---
            const tabs = document.querySelectorAll(".tab");
            const contents = document.querySelectorAll(".content");
            let activeDataType = 'url'; // Keep track of the current active tab

            tabs.forEach(tab => {
                tab.addEventListener("click", () => {
                    // Remove active state from all tabs and content
                    tabs.forEach(t => t.classList.remove("active"));
                    contents.forEach(c => c.classList.remove("active"));

                    // Add active state to clicked tab and corresponding content
                    tab.classList.add("active");
                    activeDataType = tab.getAttribute("data-type");
                    document.getElementById(`content-${activeDataType}`).classList.add("active");
                    
                    // Re-generate the QR code with the new data type
                    updateQRCode();
                });
            });

            // --- 3. GATHER AND FORMAT DATA ---
            // This function checks which tab is active and formats the data string
            function getQRData() {
                switch(activeDataType) {
                    case 'url':
                        return document.getElementById("url-input").value || "https://example.com";
                    case 'text':
                        return document.getElementById("text-input").value || "Hello World";
                    case 'wifi':
                        const ssid = document.getElementById("wifi-ssid").value;
                        const pass = document.getElementById("wifi-pass").value;
                        const security = document.getElementById("wifi-security").value;
                        if (!ssid) return "WIFI:T:WPA;S:MyNetwork;P:MyPassword;;"; // Default
                        return `WIFI:T:${security};S:${ssid};P:${pass};;`;
                    case 'vcard':
                        const name = document.getElementById("vcard-name").value;
                        const phone = document.getElementById("vcard-phone").value;
                        const email = document.getElementById("vcard-email").value;
                        const org = document.getElementById("vcard-org").value;
                        if (!name && !phone && !email) return "BEGIN:VCARD\nVERSION:3.0\nN:Doe;John\nEND:VCARD"; // Default
                        return `BEGIN:VCARD\nVERSION:3.0\nN:${name}\nTEL:${phone}\nEMAIL:${email}\nORG:${org}\nEND:VCARD`;
                    default:
                        return "https://example.com";
                }
            }

            // --- 4. LIVE UPDATE FUNCTION ---
            // This is the single function that updates the preview
            let logoImage = null; // Variable to store the logo
            
            function updateQRCode() {
                const data = getQRData();
                const dotColor = document.getElementById("color-dot").value;
                const bgColor = document.getElementById("color-bg").value;

                qrCode.update({
                    data: data,
                    dotsOptions: {
                        color: dotColor
                    },
                    backgroundOptions: {
                        color: bgColor
                    },
                    image: logoImage // Use the stored logo image
                });
            }

            // --- 5. EVENT LISTENERS FOR ALL INPUTS ---
            // This creates the "live preview" effect
            const allInputs = document.querySelectorAll(".qr-input");
            allInputs.forEach(input => {
                // 'input' event fires instantly on change
                input.addEventListener("input", updateQRCode);
            });

            // --- 6. LOGO UPLOAD LOGIC ---
            const logoInput = document.getElementById("logo-upload");
            logoInput.addEventListener("change", (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = () => {
                    logoImage = reader.result; // Store the image as a Base64 string
                    updateQRCode(); // Re-generate with the logo
                };
                reader.readAsDataURL(file);
            });
            
            // Remove Logo Button
            document.getElementById("remove-logo").addEventListener("click", () => {
                logoImage = null; // Clear the stored logo
                logoInput.value = null; // Reset the file input
                updateQRCode(); // Re-generate without the logo
            });


            // --- 7. DOWNLOAD BUTTON LOGIC ---
            // This is a key "pro" feature
            document.getElementById("download-png").addEventListener("click", () => {
                qrCode.download({ name: "qr-code", extension: "png" });
            });
            
            document.getElementById("download-svg").addEventListener("click", () => {
                qrCode.download({ name: "qr-code", extension: "svg" });
            });

            // Initial generation on page load
            updateQRCode();
        });
    </script>
